% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/data_export_queue_handling.R
\name{get_first_queued_request}
\alias{get_first_queued_request}
\title{Get First Queued Request}
\usage{
get_first_queued_request(con, job_name, max_age_seconds = NULL)
}
\arguments{
\item{con}{Database connection object (DBI connection)}

\item{job_name}{Character string identifying the job}

\item{max_age_seconds}{Numeric. Maximum age in seconds for stuck requests before auto-cleanup (default: NULL, no cleanup)}
}
\value{
List with request_id and request_time, or NULL if queue is empty
}
\description{
Finds the oldest unprocessed request for a given job.
A request is considered unprocessed if it has no corresponding 'start' event.
Automatically cleans up stuck requests older than max_age_seconds.
}
\details{
If max_age_seconds is provided, this function will automatically mark stuck requests
as 'failure' if they are older than the specified age and have no corresponding
'start' event. This prevents the queue from getting permanently blocked by
requests that crashed before starting.
}
\examples{
\dontrun{
con <- postgres_connect(needed_tables = c("processed.data_job_events"))
first <- get_first_queued_request(con, "daily_export")
if (!is.null(first)) {
  message("Next in queue: ", first$request_id)
}

# With automatic cleanup of requests older than 1 hour
first <- get_first_queued_request(con, "daily_export", max_age_seconds = 3600)
}
}
